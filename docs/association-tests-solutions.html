<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>5 Association tests - Solutions | WISG Module 4: Computational Pipeline for WGS Data</title>
  <meta name="description" content="Course materials for WISG Module 4">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="5 Association tests - Solutions | WISG Module 4: Computational Pipeline for WGS Data />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Course materials for WISG Module 4" />
  <meta name="github-repo" content="UW-GAC/WISG_2019" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Association tests - Solutions | WISG Module 4: Computational Pipeline for WGS Data />
  
  <meta name="twitter:description" content="Course materials for WISG Module 4" />
  



<meta name="date" content="2019-01-08">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="association-tests.html">
<link rel="next" href="computing-a-grm.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#schedule"><i class="fa fa-check"></i><b>1.1</b> Schedule</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#software-requirements"><i class="fa fa-check"></i><b>1.2</b> Software requirements</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#resources"><i class="fa fa-check"></i><b>1.3</b> Resources</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="gds-format.html"><a href="gds-format.html"><i class="fa fa-check"></i><b>2</b> GDS format</a><ul>
<li class="chapter" data-level="2.1" data-path="gds-format.html"><a href="gds-format.html#exploring-a-gds-file"><i class="fa fa-check"></i><b>2.1</b> Exploring a GDS file</a></li>
<li class="chapter" data-level="2.2" data-path="gds-format.html"><a href="gds-format.html#exercises"><i class="fa fa-check"></i><b>2.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="gds-solutions.html"><a href="gds-solutions.html"><i class="fa fa-check"></i><b>3</b> GDS - Solutions</a></li>
<li class="chapter" data-level="4" data-path="association-tests.html"><a href="association-tests.html"><i class="fa fa-check"></i><b>4</b> Association tests</a><ul>
<li class="chapter" data-level="4.1" data-path="association-tests.html"><a href="association-tests.html#null-model"><i class="fa fa-check"></i><b>4.1</b> Null model</a></li>
<li class="chapter" data-level="4.2" data-path="association-tests.html"><a href="association-tests.html#single-variant-tests"><i class="fa fa-check"></i><b>4.2</b> Single-variant tests</a></li>
<li class="chapter" data-level="4.3" data-path="association-tests.html"><a href="association-tests.html#exercises-1"><i class="fa fa-check"></i><b>4.3</b> Exercises</a></li>
<li class="chapter" data-level="4.4" data-path="association-tests.html"><a href="association-tests.html#sliding-window-tests"><i class="fa fa-check"></i><b>4.4</b> Sliding window tests</a></li>
<li class="chapter" data-level="4.5" data-path="association-tests.html"><a href="association-tests.html#exercise"><i class="fa fa-check"></i><b>4.5</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="association-tests-solutions.html"><a href="association-tests-solutions.html"><i class="fa fa-check"></i><b>5</b> Association tests - Solutions</a></li>
<li class="chapter" data-level="6" data-path="computing-a-grm.html"><a href="computing-a-grm.html"><i class="fa fa-check"></i><b>6</b> Computing a GRM</a></li>
<li class="chapter" data-level="7" data-path="pc-relate.html"><a href="pc-relate.html"><i class="fa fa-check"></i><b>7</b> PC-Relate</a><ul>
<li class="chapter" data-level="7.1" data-path="pc-relate.html"><a href="pc-relate.html#king"><i class="fa fa-check"></i><b>7.1</b> KING</a></li>
<li class="chapter" data-level="7.2" data-path="pc-relate.html"><a href="pc-relate.html#pc-air"><i class="fa fa-check"></i><b>7.2</b> PC-AiR</a></li>
<li class="chapter" data-level="7.3" data-path="pc-relate.html"><a href="pc-relate.html#pc-relate-1"><i class="fa fa-check"></i><b>7.3</b> PC-Relate</a></li>
<li class="chapter" data-level="7.4" data-path="pc-relate.html"><a href="pc-relate.html#comparison-with-pedigree"><i class="fa fa-check"></i><b>7.4</b> Comparison with pedigree</a></li>
<li class="chapter" data-level="7.5" data-path="pc-relate.html"><a href="pc-relate.html#exercise-1"><i class="fa fa-check"></i><b>7.5</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="mixed-models.html"><a href="mixed-models.html"><i class="fa fa-check"></i><b>8</b> Mixed models</a><ul>
<li class="chapter" data-level="8.1" data-path="mixed-models.html"><a href="mixed-models.html#null-model-1"><i class="fa fa-check"></i><b>8.1</b> Null model</a></li>
<li class="chapter" data-level="8.2" data-path="mixed-models.html"><a href="mixed-models.html#single-variant-tests-1"><i class="fa fa-check"></i><b>8.2</b> Single-variant tests</a></li>
<li class="chapter" data-level="8.3" data-path="mixed-models.html"><a href="mixed-models.html#exercise-2"><i class="fa fa-check"></i><b>8.3</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="mixed-models-solutions.html"><a href="mixed-models-solutions.html"><i class="fa fa-check"></i><b>9</b> Mixed models - Solutions</a></li>
<li class="chapter" data-level="10" data-path="variant-annotation.html"><a href="variant-annotation.html"><i class="fa fa-check"></i><b>10</b> Variant annotation</a><ul>
<li class="chapter" data-level="10.1" data-path="variant-annotation.html"><a href="variant-annotation.html#using-bioconductor-annotation-resources"><i class="fa fa-check"></i><b>10.1</b> Using Bioconductor annotation resources</a></li>
<li class="chapter" data-level="10.2" data-path="variant-annotation.html"><a href="variant-annotation.html#aggregating-and-filtering-variants-using-annotation"><i class="fa fa-check"></i><b>10.2</b> Aggregating and filtering variants using annotation</a></li>
<li class="chapter" data-level="10.3" data-path="variant-annotation.html"><a href="variant-annotation.html#aggregate-unit-for-association-testing-exercise"><i class="fa fa-check"></i><b>10.3</b> Aggregate unit for association testing exercise</a></li>
<li class="chapter" data-level="10.4" data-path="variant-annotation.html"><a href="variant-annotation.html#association-testing-with-aggregate-units"><i class="fa fa-check"></i><b>10.4</b> Association testing with aggregate units</a></li>
<li class="chapter" data-level="10.5" data-path="variant-annotation.html"><a href="variant-annotation.html#exercise-3"><i class="fa fa-check"></i><b>10.5</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="annotation-solutions.html"><a href="annotation-solutions.html"><i class="fa fa-check"></i><b>11</b> Annotation - Solutions</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">WISG Module 4: Computational Pipeline for WGS Data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="association-tests---solutions" class="section level1">
<h1><span class="header-section-number">5</span> Association tests - Solutions</h1>
<ol style="list-style-type: decimal">
<li>Logistic regression: <code>fitNullModel</code> can use a binary phenotype as the outcome variable by specifying the argument <code>family=binomial</code>. Use the <code>status</code> column in the sample annotation to fit a null model for simulated case/control status, with <code>sex</code> and <code>Population</code> as covariates. Then run a single-variant test using this model.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nullmod.status &lt;-<span class="st"> </span><span class="kw">fitNullModel</span>(annot, <span class="dt">outcome=</span><span class="st">&quot;status&quot;</span>, <span class="dt">covars=</span><span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;Population&quot;</span>), 
                               <span class="dt">family=</span>binomial, <span class="dt">verbose=</span><span class="ot">FALSE</span>)
<span class="kw">resetIterator</span>(iterator, <span class="dt">verbose=</span><span class="ot">FALSE</span>)
assoc &lt;-<span class="st"> </span><span class="kw">assocTestSingle</span>(iterator, nullmod.status, <span class="dt">test=</span><span class="st">&quot;Score&quot;</span>)</code></pre></div>
<pre><code>## # of selected samples: 1,126</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(assoc)</code></pre></div>
<pre><code>##   variant.id chr     pos allele.index n.obs         freq       Score
## 1          1   1  970546            1  1126 0.0039964476  0.20256722
## 2          2   1  985900            1  1126 0.0492895204 -2.64169956
## 3          3   1 1025045            1  1126 0.0004440497 -0.09916904
## 4          4   1 1265550            1  1126 0.0008880995  0.81717324
## 5          5   1 1472676            1  1126 0.0071047957  0.64418361
## 6          6   1 1735725            1  1126 0.0022202487 -0.46319177
##    Score.SE Score.Stat Score.pval
## 1 0.8351783  0.2425437 0.80835892
## 2 2.6522412 -0.9960254 0.31923781
## 3 0.2972472 -0.3336248 0.73866267
## 4 0.4033577  2.0259271 0.04277226
## 5 1.0778277  0.5976685 0.55006117
## 6 0.6396675 -0.7241134 0.46899613</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Inverse normal transform: use the function <code>nullModelInvNorm</code> to perform an inverse normal transform on the <code>height</code> variable. For each study separately, compute a null model and do the inverse normal transform using just the values for that study. Compare these residuals with the initial residuals you obtained for that study by transforming all studies together.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nullmod.norm.all &lt;-<span class="st"> </span><span class="kw">nullModelInvNorm</span>(nullmod, <span class="dt">norm.option=</span><span class="st">&quot;all&quot;</span>)</code></pre></div>
<pre><code>## [1]  9.820192e+01  1.688205e+02  1.557072e+02 -1.625119e+03  7.522449e-03
## [1]  6.599572e+01  1.133072e+02  1.041243e+02 -1.624934e+03  1.121317e-02
## [1]  3.256661e+01  1.404193e+01  2.035900e+01 -1.640616e+03  5.041184e-02
## [1]     0.4827084     8.3327542     8.0689110 -2114.3471115     0.7725792
## [1]     0.5140578     0.7039764     0.9389426 -1625.4237578     1.4788832
## [1]     0.7644879     0.9131510     0.9975131 -1611.9395485     1.1370448
## [1]     0.9457491     0.9938303     1.0016039 -1608.6378674     1.0224502
## [1]     0.998731     1.001647     1.001767 -1608.455879     1.001069
## [1]     1.001807     1.001730     1.001805 -1608.455310     1.000003
## [1]     1.001813     1.001731     1.001807 -1608.455310     1.000000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat.all &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">sample.id=</span>nullmod.norm.all<span class="op">$</span>sample.id, 
                      <span class="dt">resid.norm=</span>nullmod.norm.all<span class="op">$</span>resid.marginal,
                      <span class="dt">study=</span>annot<span class="op">$</span>study,
                      <span class="dt">run=</span><span class="st">&quot;combined&quot;</span>)

nullmod.norm.group &lt;-<span class="st"> </span><span class="kw">nullModelInvNorm</span>(nullmod, <span class="dt">norm.option=</span><span class="st">&quot;by.group&quot;</span>)</code></pre></div>
<pre><code>## [1]  9.820192e+01  1.688205e+02  1.557072e+02 -1.624686e+03  7.516645e-03
## [1]  6.599547e+01  1.133069e+02  1.041241e+02 -1.624502e+03  1.120455e-02
## [1]  3.254107e+01  1.394878e+01  2.030342e+01 -1.640619e+03  5.058311e-02
## [1]     0.4823649     8.3127679     8.0728042 -2113.8412464     0.7725567
## [1]     0.5136907     0.7135928     0.9316405 -1624.7322739     1.4746195
## [1]     0.7639307     0.9183081     0.9959743 -1611.5285780     1.1349499
## [1]     0.9450453     0.9939501     1.0009186 -1608.2035095     1.0221048
## [1]     0.9979798     1.0007589     1.0010808 -1608.0188191     1.0010636
## [1]     1.001052     1.000829     1.001116 -1608.018248     1.000003
## [1]     1.001058     1.000831     1.001118 -1608.018248     1.000000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat.group &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">sample.id=</span>nullmod.norm.group<span class="op">$</span>sample.id, 
                        <span class="dt">resid.norm=</span>nullmod.norm.group<span class="op">$</span>resid.marginal,
                        <span class="dt">study=</span>annot<span class="op">$</span>study,
                        <span class="dt">run=</span><span class="st">&quot;separate&quot;</span>)

dat &lt;-<span class="st"> </span><span class="kw">rbind</span>(dat.all, dat.group)

<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(study, resid.norm, <span class="dt">fill=</span>run)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</code></pre></div>
<p><img src="_main_files/figure-html/exercise_invnorm-1.png" width="672" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Repeat the previous exercise on logistic regression, this time running a sliding-window test.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nullmod.status &lt;-<span class="st"> </span><span class="kw">fitNullModel</span>(annot, <span class="dt">outcome=</span><span class="st">&quot;status&quot;</span>, <span class="dt">covars=</span><span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;Population&quot;</span>), 
                               <span class="dt">family=</span>binomial, <span class="dt">verbose=</span><span class="ot">FALSE</span>)
<span class="kw">seqResetFilter</span>(seqData, <span class="dt">verbose=</span><span class="ot">FALSE</span>)
iterator &lt;-<span class="st"> </span><span class="kw">SeqVarWindowIterator</span>(seqData, <span class="dt">windowSize=</span><span class="dv">5000</span>, <span class="dt">windowShift=</span><span class="dv">2000</span>, <span class="dt">verbose=</span><span class="ot">FALSE</span>)
assoc &lt;-<span class="st"> </span><span class="kw">assocTestAggregate</span>(iterator, nullmod, <span class="dt">test=</span><span class="st">&quot;SKAT&quot;</span>, <span class="dt">AF.max=</span><span class="fl">0.1</span>, <span class="dt">weight.beta=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">25</span>))</code></pre></div>
<pre><code>## # of selected samples: 1,126</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(assoc<span class="op">$</span>results)</code></pre></div>
<pre><code>##   chr   start     end n.site n.alt n.sample.alt        Q_0      pval_0
## 1   1  966001  971000      1     9            9   7.318094 0.643988703
## 2   1  982001  987000      1   111          107 154.178280 0.058811539
## 3   1 1022001 1027000      1     1            1  47.823916 0.005504472
## 4   1 1262001 1267000      1     2            2   7.319239 0.308472754
## 5   1 1468001 1473000      1    16           16  58.518662 0.293504072
## 6   1 1732001 1737000      1     5            5   9.499539 0.509868791
##   err_0
## 1     0
## 2     0
## 3     0
## 4     0
## 5     0
## 6     0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">seqClose</span>(gds)</code></pre></div>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="association-tests.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="computing-a-grm.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
